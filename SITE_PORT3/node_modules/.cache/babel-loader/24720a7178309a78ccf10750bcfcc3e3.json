{"ast":null,"code":"import { TempNode } from '../core/TempNode.js';\nimport { FloatNode } from '../inputs/FloatNode.js';\nimport { FunctionNode } from '../core/FunctionNode.js';\nimport { NormalNode } from '../accessors/NormalNode.js';\nimport { PositionNode } from '../accessors/PositionNode.js';\nfunction BumpMapNode(value, scale) {\n  TempNode.call(this, 'v3');\n  this.value = value;\n  this.scale = scale || new FloatNode(1);\n  this.toNormalMap = false;\n}\nBumpMapNode.Nodes = function () {\n  var dHdxy_fwd = new FunctionNode([\n  // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n  'vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {',\n  // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n  '\tvec2 dSTdx = dFdx( vUv );', '\tvec2 dSTdy = dFdy( vUv );', '\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;', '\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;', '\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;', '\treturn vec2( dBx, dBy );', '}'].join('\\n'), null, {\n    derivatives: true\n  });\n  var perturbNormalArb = new FunctionNode(['vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {',\n  // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n  '\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );', '\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );', '\tvec3 vN = surf_norm;',\n  // normalized\n  '\tvec3 R1 = cross( vSigmaY, vN );', '\tvec3 R2 = cross( vN, vSigmaX );', '\tfloat fDet = dot( vSigmaX, R1 );', '\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );', '\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );', '\treturn normalize( abs( fDet ) * surf_norm - vGrad );', '}'].join('\\n'), [dHdxy_fwd], {\n    derivatives: true\n  });\n  var bumpToNormal = new FunctionNode(['vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {', '\tvec2 dSTdx = dFdx( uv );', '\tvec2 dSTdy = dFdy( uv );', '\tfloat Hll = texture2D( bumpMap, uv ).x;', '\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;', '\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;', '\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );', '}'].join('\\n'), null, {\n    derivatives: true\n  });\n  return {\n    dHdxy_fwd: dHdxy_fwd,\n    perturbNormalArb: perturbNormalArb,\n    bumpToNormal: bumpToNormal\n  };\n}();\nBumpMapNode.prototype = Object.create(TempNode.prototype);\nBumpMapNode.prototype.constructor = BumpMapNode;\nBumpMapNode.prototype.nodeType = 'BumpMap';\nBumpMapNode.prototype.hashProperties = ['toNormalMap'];\nBumpMapNode.prototype.generate = function (builder, output) {\n  if (builder.isShader('fragment')) {\n    if (this.toNormalMap) {\n      var bumpToNormal = builder.include(BumpMapNode.Nodes.bumpToNormal);\n      return builder.format(bumpToNormal + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.value.uv.build(builder, 'v2') + ', ' + this.scale.build(builder, 'f') + ' )', this.getType(builder), output);\n    } else {\n      var derivativeHeight = builder.include(BumpMapNode.Nodes.dHdxy_fwd),\n        perturbNormalArb = builder.include(BumpMapNode.Nodes.perturbNormalArb);\n      this.normal = this.normal || new NormalNode();\n      this.position = this.position || new PositionNode(PositionNode.VIEW);\n      var derivativeHeightCode = derivativeHeight + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.value.uv.build(builder, 'v2') + ', ' + this.scale.build(builder, 'f') + ' )';\n      return builder.format(perturbNormalArb + '( -' + this.position.build(builder, 'v3') + ', ' + this.normal.build(builder, 'v3') + ', ' + derivativeHeightCode + ' )', this.getType(builder), output);\n    }\n  } else {\n    console.warn('THREE.BumpMapNode is not compatible with ' + builder.shader + ' shader.');\n    return builder.format('vec3( 0.0 )', this.getType(builder), output);\n  }\n};\nBumpMapNode.prototype.copy = function (source) {\n  TempNode.prototype.copy.call(this, source);\n  this.value = source.value;\n  this.scale = source.scale;\n  return this;\n};\nBumpMapNode.prototype.toJSON = function (meta) {\n  var data = this.getJSONNode(meta);\n  if (!data) {\n    data = this.createJSONNode(meta);\n    data.value = this.value.toJSON(meta).uuid;\n    data.scale = this.scale.toJSON(meta).uuid;\n  }\n  return data;\n};\nexport { BumpMapNode };","map":{"version":3,"names":["TempNode","FloatNode","FunctionNode","NormalNode","PositionNode","BumpMapNode","value","scale","call","toNormalMap","Nodes","dHdxy_fwd","join","derivatives","perturbNormalArb","bumpToNormal","prototype","Object","create","constructor","nodeType","hashProperties","generate","builder","output","isShader","include","format","build","uv","getType","derivativeHeight","normal","position","VIEW","derivativeHeightCode","console","warn","shader","copy","source","toJSON","meta","data","getJSONNode","createJSONNode","uuid"],"sources":["C:/Users/drncs/OneDrive/√Årea de Trabalho/PORTIFOLIO/SITE3/node_modules/three-stdlib/nodes/misc/BumpMapNode.js"],"sourcesContent":["import { TempNode } from '../core/TempNode.js';\nimport { FloatNode } from '../inputs/FloatNode.js';\nimport { FunctionNode } from '../core/FunctionNode.js';\nimport { NormalNode } from '../accessors/NormalNode.js';\nimport { PositionNode } from '../accessors/PositionNode.js';\n\nfunction BumpMapNode(value, scale) {\n  TempNode.call(this, 'v3');\n  this.value = value;\n  this.scale = scale || new FloatNode(1);\n  this.toNormalMap = false;\n}\n\nBumpMapNode.Nodes = function () {\n  var dHdxy_fwd = new FunctionNode([// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n  'vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {', // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n  '\tvec2 dSTdx = dFdx( vUv );', '\tvec2 dSTdy = dFdy( vUv );', '\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;', '\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;', '\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;', '\treturn vec2( dBx, dBy );', '}'].join('\\n'), null, {\n    derivatives: true\n  });\n  var perturbNormalArb = new FunctionNode(['vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {', // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n  '\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );', '\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );', '\tvec3 vN = surf_norm;', // normalized\n  '\tvec3 R1 = cross( vSigmaY, vN );', '\tvec3 R2 = cross( vN, vSigmaX );', '\tfloat fDet = dot( vSigmaX, R1 );', '\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );', '\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );', '\treturn normalize( abs( fDet ) * surf_norm - vGrad );', '}'].join('\\n'), [dHdxy_fwd], {\n    derivatives: true\n  });\n  var bumpToNormal = new FunctionNode(['vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {', '\tvec2 dSTdx = dFdx( uv );', '\tvec2 dSTdy = dFdy( uv );', '\tfloat Hll = texture2D( bumpMap, uv ).x;', '\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;', '\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;', '\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );', '}'].join('\\n'), null, {\n    derivatives: true\n  });\n  return {\n    dHdxy_fwd: dHdxy_fwd,\n    perturbNormalArb: perturbNormalArb,\n    bumpToNormal: bumpToNormal\n  };\n}();\n\nBumpMapNode.prototype = Object.create(TempNode.prototype);\nBumpMapNode.prototype.constructor = BumpMapNode;\nBumpMapNode.prototype.nodeType = 'BumpMap';\nBumpMapNode.prototype.hashProperties = ['toNormalMap'];\n\nBumpMapNode.prototype.generate = function (builder, output) {\n  if (builder.isShader('fragment')) {\n    if (this.toNormalMap) {\n      var bumpToNormal = builder.include(BumpMapNode.Nodes.bumpToNormal);\n      return builder.format(bumpToNormal + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.value.uv.build(builder, 'v2') + ', ' + this.scale.build(builder, 'f') + ' )', this.getType(builder), output);\n    } else {\n      var derivativeHeight = builder.include(BumpMapNode.Nodes.dHdxy_fwd),\n          perturbNormalArb = builder.include(BumpMapNode.Nodes.perturbNormalArb);\n      this.normal = this.normal || new NormalNode();\n      this.position = this.position || new PositionNode(PositionNode.VIEW);\n      var derivativeHeightCode = derivativeHeight + '( ' + this.value.build(builder, 'sampler2D') + ', ' + this.value.uv.build(builder, 'v2') + ', ' + this.scale.build(builder, 'f') + ' )';\n      return builder.format(perturbNormalArb + '( -' + this.position.build(builder, 'v3') + ', ' + this.normal.build(builder, 'v3') + ', ' + derivativeHeightCode + ' )', this.getType(builder), output);\n    }\n  } else {\n    console.warn('THREE.BumpMapNode is not compatible with ' + builder.shader + ' shader.');\n    return builder.format('vec3( 0.0 )', this.getType(builder), output);\n  }\n};\n\nBumpMapNode.prototype.copy = function (source) {\n  TempNode.prototype.copy.call(this, source);\n  this.value = source.value;\n  this.scale = source.scale;\n  return this;\n};\n\nBumpMapNode.prototype.toJSON = function (meta) {\n  var data = this.getJSONNode(meta);\n\n  if (!data) {\n    data = this.createJSONNode(meta);\n    data.value = this.value.toJSON(meta).uuid;\n    data.scale = this.scale.toJSON(meta).uuid;\n  }\n\n  return data;\n};\n\nexport { BumpMapNode };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}