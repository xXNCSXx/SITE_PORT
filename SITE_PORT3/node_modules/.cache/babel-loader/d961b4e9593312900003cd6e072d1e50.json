{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nimport { contains, every, has, some } from \"../../../utils/utils\";\nimport { AbstractProduction, Alternation, Alternative, NonTerminal, Option, Repetition, RepetitionMandatory, RepetitionMandatoryWithSeparator, RepetitionWithSeparator, Rule, Terminal } from \"./gast_public\";\nimport { GAstVisitor } from \"./gast_visitor_public\";\nexport function isSequenceProd(prod) {\n  return prod instanceof Alternative || prod instanceof Option || prod instanceof Repetition || prod instanceof RepetitionMandatory || prod instanceof RepetitionMandatoryWithSeparator || prod instanceof RepetitionWithSeparator || prod instanceof Terminal || prod instanceof Rule;\n}\nexport function isOptionalProd(prod, alreadyVisited) {\n  if (alreadyVisited === void 0) {\n    alreadyVisited = [];\n  }\n  var isDirectlyOptional = prod instanceof Option || prod instanceof Repetition || prod instanceof RepetitionWithSeparator;\n  if (isDirectlyOptional) {\n    return true;\n  }\n  // note that this can cause infinite loop if one optional empty TOP production has a cyclic dependency with another\n  // empty optional top rule\n  // may be indirectly optional ((A?B?C?) | (D?E?F?))\n  if (prod instanceof Alternation) {\n    // for OR its enough for just one of the alternatives to be optional\n    return some(prod.definition, function (subProd) {\n      return isOptionalProd(subProd, alreadyVisited);\n    });\n  } else if (prod instanceof NonTerminal && contains(alreadyVisited, prod)) {\n    // avoiding stack overflow due to infinite recursion\n    return false;\n  } else if (prod instanceof AbstractProduction) {\n    if (prod instanceof NonTerminal) {\n      alreadyVisited.push(prod);\n    }\n    return every(prod.definition, function (subProd) {\n      return isOptionalProd(subProd, alreadyVisited);\n    });\n  } else {\n    return false;\n  }\n}\nexport function isBranchingProd(prod) {\n  return prod instanceof Alternation;\n}\nexport function getProductionDslName(prod) {\n  /* istanbul ignore else */\n  if (prod instanceof NonTerminal) {\n    return \"SUBRULE\";\n  } else if (prod instanceof Option) {\n    return \"OPTION\";\n  } else if (prod instanceof Alternation) {\n    return \"OR\";\n  } else if (prod instanceof RepetitionMandatory) {\n    return \"AT_LEAST_ONE\";\n  } else if (prod instanceof RepetitionMandatoryWithSeparator) {\n    return \"AT_LEAST_ONE_SEP\";\n  } else if (prod instanceof RepetitionWithSeparator) {\n    return \"MANY_SEP\";\n  } else if (prod instanceof Repetition) {\n    return \"MANY\";\n  } else if (prod instanceof Terminal) {\n    return \"CONSUME\";\n  } else {\n    throw Error(\"non exhaustive match\");\n  }\n}\nvar DslMethodsCollectorVisitor = /** @class */function (_super) {\n  __extends(DslMethodsCollectorVisitor, _super);\n  function DslMethodsCollectorVisitor() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    // A minus is never valid in an identifier name\n    _this.separator = \"-\";\n    _this.dslMethods = {\n      option: [],\n      alternation: [],\n      repetition: [],\n      repetitionWithSeparator: [],\n      repetitionMandatory: [],\n      repetitionMandatoryWithSeparator: []\n    };\n    return _this;\n  }\n  DslMethodsCollectorVisitor.prototype.reset = function () {\n    this.dslMethods = {\n      option: [],\n      alternation: [],\n      repetition: [],\n      repetitionWithSeparator: [],\n      repetitionMandatory: [],\n      repetitionMandatoryWithSeparator: []\n    };\n  };\n  DslMethodsCollectorVisitor.prototype.visitTerminal = function (terminal) {\n    var key = terminal.terminalType.name + this.separator + \"Terminal\";\n    if (!has(this.dslMethods, key)) {\n      this.dslMethods[key] = [];\n    }\n    this.dslMethods[key].push(terminal);\n  };\n  DslMethodsCollectorVisitor.prototype.visitNonTerminal = function (subrule) {\n    var key = subrule.nonTerminalName + this.separator + \"Terminal\";\n    if (!has(this.dslMethods, key)) {\n      this.dslMethods[key] = [];\n    }\n    this.dslMethods[key].push(subrule);\n  };\n  DslMethodsCollectorVisitor.prototype.visitOption = function (option) {\n    this.dslMethods.option.push(option);\n  };\n  DslMethodsCollectorVisitor.prototype.visitRepetitionWithSeparator = function (manySep) {\n    this.dslMethods.repetitionWithSeparator.push(manySep);\n  };\n  DslMethodsCollectorVisitor.prototype.visitRepetitionMandatory = function (atLeastOne) {\n    this.dslMethods.repetitionMandatory.push(atLeastOne);\n  };\n  DslMethodsCollectorVisitor.prototype.visitRepetitionMandatoryWithSeparator = function (atLeastOneSep) {\n    this.dslMethods.repetitionMandatoryWithSeparator.push(atLeastOneSep);\n  };\n  DslMethodsCollectorVisitor.prototype.visitRepetition = function (many) {\n    this.dslMethods.repetition.push(many);\n  };\n  DslMethodsCollectorVisitor.prototype.visitAlternation = function (or) {\n    this.dslMethods.alternation.push(or);\n  };\n  return DslMethodsCollectorVisitor;\n}(GAstVisitor);\nexport { DslMethodsCollectorVisitor };\nvar collectorVisitor = new DslMethodsCollectorVisitor();\nexport function collectMethods(rule) {\n  collectorVisitor.reset();\n  rule.accept(collectorVisitor);\n  var dslMethods = collectorVisitor.dslMethods;\n  // avoid uncleaned references\n  collectorVisitor.reset();\n  return dslMethods;\n}","map":{"version":3,"names":["contains","every","has","some","AbstractProduction","Alternation","Alternative","NonTerminal","Option","Repetition","RepetitionMandatory","RepetitionMandatoryWithSeparator","RepetitionWithSeparator","Rule","Terminal","GAstVisitor","isSequenceProd","prod","isOptionalProd","alreadyVisited","isDirectlyOptional","definition","subProd","push","isBranchingProd","getProductionDslName","Error","DslMethodsCollectorVisitor","_super","__extends","_this","apply","arguments","separator","dslMethods","option","alternation","repetition","repetitionWithSeparator","repetitionMandatory","repetitionMandatoryWithSeparator","prototype","reset","visitTerminal","terminal","key","terminalType","name","visitNonTerminal","subrule","nonTerminalName","visitOption","visitRepetitionWithSeparator","manySep","visitRepetitionMandatory","atLeastOne","visitRepetitionMandatoryWithSeparator","atLeastOneSep","visitRepetition","many","visitAlternation","or","collectorVisitor","collectMethods","rule","accept"],"sources":["../../../../../src/parse/grammar/gast/gast.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}